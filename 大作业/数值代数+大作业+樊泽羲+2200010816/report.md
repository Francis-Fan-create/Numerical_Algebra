# 数值代数大作业

**史博文**

**2023年2月**

## 1 问题背景

### 1.1 Stokes方程

考虑Stokes方程

\[
-\Delta \vec{u} + \nabla p = \vec{F}, \quad \text{div} \vec{u} = 0
\]

边界条件为

\[
\frac{\partial u}{\partial\vec{n}} = b, \; y = 0, \quad \frac{\partial u}{\partial\vec{n}} = t, \; y = 1,
\]
\[
\frac{\partial v}{\partial\vec{n}} = l, \; x = 0, \quad \frac{\partial v}{\partial\vec{n}} = r, \; x = 1,
\]
\[
u = 0, \; x = 0,1, \quad v = 0, \; y = 0,1.
\]

其中 \(\vec{u} = (u,v)\) 为速度, \(p\) 为压力, \(\vec{F} = (f,g)\) 为外力, \(\vec{n}\) 为外法向方向。在区域 \(\Omega = (0,1)\times (0,1)\) 上，外力为

\[
f(x,y) = -4\pi^2 (2\cos (2\pi x) - 1)\sin (2\pi y) + x^2,
\]
\[
g(x,y) = 4\pi^2 (2\cos (2\pi y) - 1)\sin (2\pi x).
\]

Stokes方程的真解为

\[
u(x,y) = (1 - \cos (2\pi x))\sin (2\pi y),
\]
\[
v(x,y) = -(1 - \cos (2\pi y))\sin (2\pi x),
\]
\[
p(x,y) = \frac{x^3}{3} -\frac{1}{12}.
\]

### 1.2 交错网格上的MAC格式

设计关于 \(u,v\) 和 \(p\) 交错的MAC格式，并利用有限差分法对原问题进行离散。在内部格点直接利用差分格式逼近算子，在Neumann边界处利用影子单元进行离散，而在强制边界条件处可以不列方程。由此可得（下标表示位置）：

关于 \(u\) 的方程 \((h = 1 / N)\)：

(1) 当 \(1\leq i\leq N - 1, \; 2\leq j\leq N - 1\)

\[
-\frac{u_{i + 1,j - \frac{1}{2}} - 2u_{i,j - \frac{1}{2}} + u_{i - 1,j - \frac{1}{2}}}{h^2} -\frac{u_{i,j + \frac{1}{2}} - 2u_{i,j - \frac{1}{2}} + u_{i,j - \frac{3}{2}}}{h^2} +\frac{p_{i + \frac{1}{2},j - \frac{1}{2}} - p_{i - \frac{1}{2},j - \frac{1}{2}}}{h} = f_{i,j - \frac{1}{2}};
\]

(2) 当 \(1\leq i\leq N - 1 \; (j = 1)\)

\[
-\frac{u_{i,\frac{3}{2}} - u_{i,\frac{1}{2}}}{h^2} -\frac{b_{i,0}}{h} -\frac{u_{i + 1,\frac{1}{2}} - 2u_{i,\frac{1}{2}} + u_{i - 1,\frac{1}{2}}}{h^2} +\frac{p_{i + \frac{1}{2},\frac{1}{2}} - p_{i - \frac{1}{2},\frac{1}{2}}}{h} = f_{i,\frac{1}{2}};
\]

(3) 当 \(1\leq i\leq N - 1 \; (j = N)\)

\[
-\frac{u_{i,N - \frac{1}{2}} - u_{i,N - \frac{3}{2}}}{h^2} -\frac{t_{i,N}}{h} -\frac{u_{i + 1,N - \frac{1}{2}} - 2u_{i,N - \frac{1}{2}} + u_{i - 1,N - \frac{1}{2}}}{h^2} +\frac{p_{i + \frac{1}{2},N - \frac{1}{2}} - p_{i - \frac{1}{2},N - \frac{1}{2}}}{h} = f_{i,N - \frac{1}{2}}.
\]

*图1: 交错网格上的MAC格式（图片来源：胡俊教授）*

以及关于 \(v\) 的方程 \((h = 1 / N)\)：

(1) 当 \(1\leq j\leq N - 1, \; 2\leq i\leq N - 1\),

\[
-\frac{v_{i + \frac{1}{2},j} - 2v_{i - \frac{1}{2},j} + v_{i - \frac{3}{2},j}}{h^2} -\frac{v_{i - \frac{1}{2},j + 1} - 2v_{i - \frac{1}{2},j} + v_{i - \frac{1}{2},j - 1}}{h^2} +\frac{p_{i - \frac{1}{2},j + \frac{1}{2}} - p_{i - \frac{1}{2},j - \frac{1}{2}}}{h} = g_{i - \frac{1}{2},j};
\]

(2) 当 \(1\leq j\leq N - 1 \; (i = 1)\)

\[
-\frac{v_{\frac{3}{2},j} - v_{\frac{1}{2},j}}{h^2} -\frac{l_{0,j}}{h} -\frac{v_{\frac{1}{2},j + 1} - 2v_{\frac{1}{2},j} + v_{\frac{1}{2},j - 1}}{h^2} +\frac{p_{\frac{1}{2},j + \frac{1}{2}} - p_{\frac{1}{2},j - \frac{1}{2}}}{h} = g_{\frac{1}{2},j};
\]

(3) 当 \(1\leq j\leq N - 1 \; (i = N)\)

\[
-\frac{v_{N - \frac{1}{2},j} - v_{N - \frac{3}{2},j}}{h^2} -\frac{r_{N,j}}{h} -\frac{v_{N - \frac{1}{2},j + 1} - 2v_{N - \frac{1}{2},j} + v_{N - \frac{1}{2},j - 1}}{h^2} +\frac{p_{N - \frac{1}{2},j + \frac{1}{2}} - p_{N - \frac{1}{2},j - \frac{1}{2}}}{h} = g_{N - \frac{1}{2},j}.
\]

不可压条件 \((1\leq i\leq N, \; 1\leq j\leq N)\)：

\[
\frac{u_{i,j - \frac{1}{2}} - u_{i - 1,j - \frac{1}{2}}}{h} +\frac{v_{i - \frac{1}{2},j} - v_{i - \frac{1}{2},j - 1}}{h} = 0.
\]

整理可得到如下线性方程组

\[
\left( \begin{array}{cc}A & B\\ B^T & 0 \end{array} \right)\left( \begin{array}{c}U\\ P \end{array} \right) = \left( \begin{array}{c}F\\ 0 \end{array} \right).
\]

其中，\(U\) 为 \(2N(N - 1)\) 维向量，\(P\) 为 \(N^2\) 维向量。注意到，矩阵 \(A\) 可以看作两个混合边界条件下离散 Laplacian 算子矩阵组合成的分块对角矩阵，因此是对称正定的，所以速度 \(U\) 可以被唯一确定。另一方面，对系数矩阵行变换，消去项 \(B^T\) 可得压力 \(P\) 前的系数矩阵为 \(B^T A^{-1}B\)。

### 1.3 V-cycle 多重网格方法

V-cycle 多重网格方法是一种加速求解线性方程组迭代法收敛的算法。主要步骤为：
1. 在细网格上进行若干次磨光迭代（如 Gauss-Seidel 迭代）。
2. 计算残差，并将其通过限制算子转移到粗网格上。
3. 在粗网格上求解或迭代求解残差方程。
4. 将通过延拓算子将粗网格上的修正量提升回细网格。
5. 在细网格上进行若干次磨光迭代。

*图 2: 提升和限制算子的实现方法 (图片来源: 吴清玉)*

### 1.4 \(B^{T}A^{-1}B\) 的特征值

下面证明，矩阵 \(B^{T}A^{- 1}B\) 的特征值仅有0和1，且0特征值为单特征值。由此可以推出，离散压力 \(P\) 的解空间是一维的。

如果

\[
B^{T}A^{-1}BP = \lambda P,
\]

进一步改写为

\[
\left\{ \begin{array}{ll}AU + BP = 0,\\ -B^{T}U = \lambda P. \end{array} \right.
\]

注意到，\(A,B, - B^{T}\) 可以看作离散状态的 \(\Delta\) ,grad,div算子，于是不妨考虑连续的特征值问题：

\[
\left\{ \begin{array}{ll} - \Delta \vec{u} +\nabla p = 0\\ \mathrm{div}\vec{u} = \lambda p. \end{array} \right.
\]

即

\[
\nabla \mathrm{div}\vec{u} = \lambda \Delta \vec{u}.
\]

(1)取 \(\lambda = 0\)，得 \(\mathrm{div}\vec{u} = 0\)。此时取 \(U = 0\)，\(P\) 为所有元素均相等的向量。
(2)取 \(\lambda = 1\)，得 \(\frac{\partial u}{\partial y} - \frac{\partial u}{\partial z} = C\)。此时特征值问题

\[
\nabla \mathrm{div}\vec{u} = \lambda^{\prime}\vec{u}, \quad -BB^{T}x = \lambda^{\prime}x,
\]

的解，一定是特征值问题

\[
\Delta \vec{u} = \lambda^{\prime}\vec{u}, \quad Ax = \lambda^{\prime}x
\]

的解。

令

\[
B_{N - 1} = \left( \begin{array}{cccccc}2 & -1 & 0 & \dots & & \\ -1 & 2 & -1 & 0 & \dots & \\ \dots & -1 & 2 & -1 & 0 & \\ \dots & -1 & 2 & -1 & 0 & \\ \ldots & 0 & -1 & 2 & \dots & \\ \dots & 0 & -1 & 2 & \dots & \end{array} \right)_{N - 1\times N - 1}, \quad R_{N} = \left( \begin{array}{cccccc}1 & -1 & 0 & \dots & & \\ -1 & 2 & -1 & 0 & \dots & \\ \dots & 0 & -1 & 2 & -1 & \\ \dots & 0 & -1 & 1 & \dots & \end{array} \right)_{N\times N}
\]

直接计算可得：

\[
A = \left( \begin{array}{cc}A_{1} & 0\\ 0 & A_{1} \end{array} \right), \quad A_{1} = B_{N - 1}\oplus R_{N}, \quad B^{T}B = R_{N}\oplus R_{N}.
\]

其中 \(\oplus\) 为Kronecker直和，\(A\oplus B = I\otimes A + B\otimes I.\)

注意到 \(B_{N}\) 的特征值全部非零，且与 \(R_{N}\) 的非零特征值相同。于是由 Kronecker 直和的性质，\(B^{T}B\) 的全部特征值包括在 \(A\) 的特征值中（计算重数）。

设 \(A^{- 1} = P^{T}D^{- 1}P\)，\(S = PB\)。则 \(B^{T}A^{- 1}B = S^{T}D^{- 1}S\)。奇异值分解得

\[
S = \sum_{i = 1}^{r}s_{i}u_{i}v_{i}^{T},
\]
\[
S^{T}D^{-1}S = \sum_{i = 1}^{r}s_{i}^{2}(u_{i}D^{-1}u_{i}^{T})v_{i}v_{i}^{T}.
\]

由于

\[
S S^{T}u_{i} = s_{i}^{2}u_{i},
\]

所以

\[
BB^{T}(P^{T}u_{i}) = s_{i}^{2}P^{T}u_{i}.
\]

由上结论可知

\[
A(P^{T}u_{i}) = s_{i}^{2}P^{T}u_{i},
\]

即 \(u_{i}D^{- 1}u_{i}^{T} = s_{i}^{- 2}\)。所以得 \(B^{T}A^{- 1}B\) 的非零特征值都是 1。同时 \(rank(B^{T}A^{- 1}B) = rank(B^{T}B) = N^{2} - 1\)，所以 0 特征值为 1 重。

## 2 第一题

### 2.1 题目要求

分别取 \(N = 64,128,256,512,1024,2048\)，以 DGS 为磨光子，用基于 V-cycle 的多重网格方法求解上述离散问题，停机标准为 \(\| r_{h}\|_{2} / \| r_{0}\|_{2} \leq 10^{- 8}\)，对不同的 \(\nu_{1}, \nu_{2}, L\)，比较 V-cycle 的次数和 CPU 时间，并计算误差

\[
e_{N} = h\left(\sum_{j = 1}^{N}\sum_{i = 1}^{N - 1}\left|u_{i,j - \frac{1}{2}} - u\left(x_{i},y_{j - \frac{1}{2}}\right)\right|^{2} + \sum_{j = 1}^{N - 1}\sum_{i = 1}^{N}\left|v_{i - \frac{1}{2},j} - v\left(x_{i - \frac{1}{2}},y_{j}\right)\right|^{2}\right)^{\frac{1}{2}}.
\]

### 2.2 DGS 迭代法

给定初始值 \(U_0 = (u_0^T, v_0^T)^T\) 和 \(P_0\)（均取为零），令 \(k = 0, A = D_A - L_A - U_A\)，DGS 迭代法定义如下：

1. 用 Gauss-Seidel 迭代方法更新速度分量
   \[
   U^{k+1/2} = U^k + (D_A - L_A)^{-1} (F - BP^k - AU^k)。
   \]
2. 更新速度与压力：
   （1）对内部单元 \((i, j)\)（四个顶点 \(((i-1)h, (j-1)h), (ih, (j-1)h), (ih, jh), ((i-1)h, jh)\)），\(2 \leq i, j \leq N-1\)，
       计算散度方程的残量
       \[
       r_{i,j} = -\frac{u^{k+1/2}_{i,j-\frac12} - u^{k+1/2}_{i-1,j-\frac12}}{h} -\frac{v^{k+1/2}_{i-\frac12,j} - v^{k+1/2}_{i-\frac12,j-1}}{h},
       \]
       并令 \(\delta = r_{i,j}h/4\)。
       更新内部单元速度:
       \[
       \begin{aligned}
       &u^{k+1/2}_{i-1,j-\frac12} = u^{k+1/2}_{i-1,j-\frac12} - \delta, \\
       &u^{k+1/2}_{i,j-\frac12} = u^{k+1/2}_{i,j-\frac12} + \delta, \\
       &v^{k+1/2}_{i-\frac12,j-1} = v^{k+1/2}_{i-\frac12,j-1} - \delta, \\
       &v^{k+1/2}_{i-\frac12,j} = v^{k+1/2}_{i-\frac12,j} + \delta.
       \end{aligned}
       \]
       更新内部单元的压力:
       \[
       \begin{aligned}
       &p^{k}_{i-\frac12,j-\frac12} = p^{k}_{i-\frac12,j-\frac12} + r_{i,j}, \\
       &p^{k}_{i+\frac12,j-\frac12} = p^{k}_{i+\frac12,j-\frac12} - r_{i,j}/4, \\
       &p^{k}_{i-\frac32,j-\frac12} = p^{k}_{i-\frac32,j-\frac12} - r_{i,j}/4, \\
       &p^{k}_{i-\frac12,j+\frac12} = p^{k}_{i-\frac12,j+\frac12} - r_{i,j}/4, \\
       &p^{k}_{i-\frac12,j-\frac32} = p^{k}_{i-\frac12,j-\frac32} - r_{i,j}/4.
       \end{aligned}
       \]
   （2）对边界单元 \((i, N)\)（四个顶点 \(((i-1)h, (N -1)h), (ih, (N -1)h), (ih, Nh), ((i-1)h, Nh))\)，\(2 \leq i \leq N-1\)，
       先计算散度的残量 \(r_{i,N}\)，计算公式如前，并令 \(\delta = r_{i,N}h/3\)。
       速度更新如下:
       \[
       \begin{aligned}
       &u^{k+1/2}_{i-1,N-\frac12} = u^{k+1/2}_{i-1,N-\frac12} - \delta, \\
       &u^{k+1/2}_{i,N-\frac12} = u^{k+1/2}_{i,N-\frac12} + \delta, \\
       &v^{k+1/2}_{i-\frac12,N-1} = v^{k+1/2}_{i-\frac12,N-1} - \delta.
       \end{aligned}
       \]
       更新边界单元 \((i, N)\) 的压力:
       \[
       \begin{aligned}
       &p^{k}_{i-\frac12,N-\frac12} = p^{k}_{i-\frac12,N-\frac12} + r_{i,N}, \\
       &p^{k}_{i+\frac12,N-\frac12} = p^{k}_{i+\frac12,N-\frac12} - r_{i,N}/3, \\
       &p^{k}_{i-\frac32,N-\frac12} = p^{k}_{i-\frac32,N-\frac12} - r_{i,N}/3, \\
       &p^{k}_{i-\frac12,N-\frac32} = p^{k}_{i-\frac12,N-\frac32} - r_{i,N}/3.
       \end{aligned}
       \]
   （3）类似更新边界单元 \((N, j)\) 和 \((1, j)\)，\(2 \leq j \leq N-1\)，以及 \((i, 1)\)，\(2 \leq i \leq N-1\) 的速度和压力。
   （4）对顶点单元 \((1, 1)\)，计算散度残量 \(r_{1,1}\)，计算公式如前，令 \(\delta = r_{1,1}h/2\)。更新速度如下:
       \[
       \begin{aligned}
       &u^{k+1/2}_{1,\frac12} = u^{k+1/2}_{1,\frac12} + \delta, \\
       &v^{k+1/2}_{\frac12,1} = v^{k+1/2}_{\frac12,1} + \delta.
       \end{aligned}
       \]
       更新压力（根据上下文补充，此处略去具体公式）。
   （5）对其他顶点单元 \((1,N),(N,1)\) 和 \((N,N)\)，类似更新速度和压力。

### 2.3 算法实现

**Algorithm 2 以 DGS 迭代法为磨光子的 V-cycle 多重网格算法**

while ‖r_h‖_2 / ‖r_0‖_2 > 10^{-8} do
repeat
利用 DGS 磨光算子迭代 ν1 次，计算残量并限制到下一层。
until 到达底层网格，网格参数为 N / L
repeat
利用 DGS 磨光算子磨光迭代 ν2 次，计算残量并提升到上一层。
until 到达顶层
end while

其中值得注意的是，在编写 DGS 磨光子时，更新速度与压力需要覆盖式更新；为保证计算速度、减少存储，\(U, P\) 均用矩阵存储，实现算法的元素数组矩阵运行。同时，为避免计算提升和限制后的系数矩阵，可以直接利用网格上的 MAC 格式近似。

提升或限制后的方程如果不再满足散度为 0 条件，此时待求解的线性方程组将形如

\[
\left( \begin{array}{cc}A & B\\ B^{T} & 0 \end{array} \right)\left( \begin{array}{c}U\\ P \end{array} \right) = \left( \begin{array}{c}F\\ D \end{array} \right).
\]

其中 \(D = [d_{i,j}]\) 为负的数值散度。在利用 DGS 迭代法求解上述线性方程组时，散度方程的残量 \(r_{i,j}\) 将变为

\[
r_{i,j} = -\frac{u_{i,j - \frac{1}{2}}^{k + \frac{1}{2}} - u_{i - 1,j - \frac{1}{2}}^{k + \frac{1}{2}}}{h} -\frac{v_{i - \frac{1}{2},j}^{k + \frac{1}{2}} - v_{i - \frac{1}{2},j - 1}^{k + \frac{1}{2}}}{h} - d_{i,j}.
\]

### 2.4 数值结果

#### 2.4.1 误差

| N    | 误差       |
| ---- | ---------- |
| 64   | 0.0015     |
| 128  | 3.7362e-04 |
| 256  | 9.3391e-05 |
| 512  | 2.3342e-05 |
| 1024 | 5.8298e-06 |
| 2048 | 1.4521e-06 |

#### 2.4.2 不同迭代次数与底层网格大小的运行时间和 V-cycle 次数比较

**参数：** \( \nu_{1} = 6, \; \nu_{2} = 6 \)，底层网格参数 \( N / L = 2 \)，底层网格为 \(2\times 2\)

| N    | CPU 时间(秒) | V-cycle 次数 |
| ---- | ------------ | ------------ |
| 64   | 0.035066     | 5            |
| 128  | 0.116906     | 5            |
| 256  | 0.504635     | 5            |
| 512  | 3.198413     | 5            |
| 1024 | 18.449256    | 5            |
| 2048 | 115.347889   | 5            |

**参数：** \( \nu_{1} = 6, \; \nu_{2} = 6 \)，底层网格参数 \( N / L = 4 \)，底层网格为 \(4\times 4\)

| N    | CPU 时间(秒) | V-cycle 次数 |
| ---- | ------------ | ------------ |
| 64   | 0.034006     | 5            |
| 128  | 0.1136572    | 5            |
| 256  | 0.514653     | 5            |
| 512  | 3.28567      | 5            |
| 1024 | 18.117632    | 5            |
| 2048 | 113.567349   | 5            |

**参数：** \( \nu_{1} = 4, \; \nu_{2} = 4 \)，底层网格参数 \( N / L = 2 \)，底层网格为 \(2\times 2\)

| N    | CPU 时间(秒) | V-cycle 次数 |
| ---- | ------------ | ------------ |
| 64   | 0.026561     | 5            |
| 128  | 0.088919     | 5            |
| 256  | 0.447595     | 5            |
| 512  | 2.386111     | 5            |
| 1024 | 14.182898    | 5            |
| 2048 | 95.886059    | 5            |

**参数：** \( \nu_{1} = 4, \; \nu_{2} = 4 \)，底层网格参数 \( N / L = 4 \)，底层网格为 \(4\times 4\)

| N    | CPU 时间(秒) | V-cycle 次数 |
| ---- | ------------ | ------------ |
| 64   | 0.025837     | 5            |
| 128  | 0.088566     | 5            |
| 256  | 0.390343     | 5            |
| 512  | 2.365471     | 5            |
| 1024 | 13.721832    | 5            |
| 2048 | 93.78463     | 5            |

**参数：** \( \nu_{1} = 2, \; \nu_{2} = 2 \)，底层网格参数 \( N / L = 2 \)，底层网格为 \(2\times 2\)

| N    | CPU 时间(秒) | V-cycle 次数 |
| ---- | ------------ | ------------ |
| 64   | 0.024367     | 6            |
| 128  | 0.089628     | 6            |
| 256  | 0.303787     | 6            |
| 512  | 1.827113     | 6            |
| 1024 | 10.392901    | 6            |
| 2048 | 71.886059    | 6            |

**参数：** \( \nu_{1} = 2, \; \nu_{2} = 2 \)，底层网格参数 \( N / L = 4 \)，底层网格为 \(4\times 4\)

| N    | CPU 时间(秒) | V-cycle 次数 |
| ---- | ------------ | ------------ |
| 64   | 0.025496     | 6            |
| 128  | 0.095634     | 6            |
| 256  | 0.370122     | 6            |
| 512  | 1.817791     | 6            |
| 1024 | 10.566532    | 6            |
| 2048 | 73.567349    | 6            |

## 3 第二题

### 3.1 题目要求

分别取 \(N = 64,128,256,512\)，以 Uzawa 迭代法求解上述离散问题，停机标准为 \(\| r_{h}\|_{2} / \| r_{0}\|_{2}\leq 10^{- 8}\)，并计算误差

\[
e_{N} = h\left(\sum_{j = 1}^{N}\sum_{i = 1}^{N - 1}\left|u_{i,j - \frac{1}{2}} - u\left(x_{i},y_{j - \frac{1}{2}}\right)\right|^{2} + \sum_{j = 1}^{N - 1}\sum_{i = 1}^{N}\left|v_{i - \frac{1}{2},j} - v\left(x_{i - \frac{1}{2}},y_{j}\right)\right|^{2}\right)^{\frac{1}{2}}.
\]

### 3.2 Uzawa迭代法、共轭梯度法与最优参数 \(\alpha^{*}\) 的选取

**Algorithm 3 Uzawa 迭代法**

Require: P0, k = 0
while ‖r_h‖*2 / ‖r_0‖\*2 > 10^{-8} do
利用共轭梯度法求解 A U\*{k+1} = F - B P_k
更新压力 P*{k+1} = P_k + α (B^T U_{k+1})
k = k + 1
end while

**Algorithm 4 共轭梯度法**

Require: x
k = 0; r = b - A x; ρ = r^T r
while (√ρ > ε ‖b‖_2) 以及 (k < k_max) do
k = k + 1
if k = 1 then
p = r
else
β = ρ / \tilde{ρ}; p = r + β p
end if
w = A p; α = ρ / (p^T w); x = x + α p
r = r - α w; \tilde{ρ} = ρ; ρ = r^T r
end while

因为

\[
\begin{aligned}
P_{k+1} &= P_k + \alpha \left(B^{T}A^{-1}\left(F - BP_k\right)\right) \\
&= \left(I - \alpha B^{T}A^{-1}B\right)P_k + \alpha B^{T}A^{-1}F,
\end{aligned}
\]

因此，关于压力的更新方法，相当于下面的线性代数方程组

\[
B^{T}A^{-1}B P = B^{T}A^{-1}F
\]

的迭代格式。由第一节所得结论，可知 \(I - \alpha B^{T}A^{- 1}B\) 的特征值只有 1 和 \(1 - \alpha\)。可知 \(\alpha = 1\) 为最优参数。

### 3.3 数值结果

计算所得误差如下：

| N    | 误差       |
| ---- | ---------- |
| 64   | 0.0015     |
| 128  | 3.7363e-04 |
| 256  | 9.3398e-05 |
| 512  | 2.3349e-05 |

## 4 第三题

### 4.1 题目要求

分别取 \(N = 64,128,256,512,1024,2048\)，以 Inexact Uzawa Iteration Method 为迭代法求解上述离散问题，停机标准为 \(\| r_{k}\|_{2} / \| r_{0}\|_{2}\leq 10^{- 8}\)，其中以 V-cycle 多重网格方法为预优子求解每一步的子问题 \(AU_{k + 1} = F - BP_{k}\)，对不同的 \(\alpha ,\tau ,\nu_{1},\nu_{2},L\)，比较外循环的迭代次数和 CPU 时间，并计算误差

\[
e_{N} = h\left(\sum_{j = 1}^{N}\sum_{i = 1}^{N - 1}\left|u_{i,j - \frac{1}{2}} - u\left(x_{i},y_{j - \frac{1}{2}}\right)\right|^{2} + \sum_{j = 1}^{N - 1}\sum_{i = 1}^{N}\left|v_{i - \frac{1}{2},j} - v\left(x_{i - \frac{1}{2}},y_{j}\right)\right|^{2}\right)^{\frac{1}{2}}.
\]

### 4.2 Inexact Uzawa 迭代方法与 V-cycle 预优共轭梯度法

**Algorithm 5 Inexact Uzawa 迭代法**

Require: P0, k = 0
while ‖r_h‖*2 / ‖r_0‖\*2 > 10^{-8} do
以 V-cycle 预优共轭梯度法求解 A U\*{k+1} = F - B P_k，得到近似解 \hat{U}*{k+1}
更新压力 P_{k+1} = P_k + α (B^T \hat{U}_{k+1})
k = k + 1
end while

设 \(\hat{U}_{k + 1}\) 是方程 \(AU_{k + 1} = F - BP_k\) 的近似解。定义

\[
\delta_k = A\hat{U}_{k + 1} - F + BP_k。
\]

若

\[
\| \delta_k\| _2\leq \tau \left\| B^T \hat{U}_k\right\|_2,
\]

当 \(\tau\) 充分小时，上述迭代方法是收敛的。

**Algorithm 6 V-cycle 预优共轭梯度法**

Require: x
k = 0; r = b - A x; ρ = r^T r
while (√(r^T r) > max(ε ‖b‖_2, τ ‖B^T \hat{U}_k‖_2)) 以及 (k < k_max) do
k = k + 1
以对称 Gauss-Seidel 迭代法为磨光子，利用 V-cycle 多重网格方法求解 A z = r
if k = 1 then
p = z; ρ = r^T z
else
\tilde{ρ} = ρ; ρ = r^T z; β = ρ / \tilde{ρ}; p = z + β p
end if
w = A p; α = ρ / (p^T w); x = x + α p; r = r - α w
end while

其中，对称 GS 迭代指的是通过分量形式

\[
(D_A - L_A)z_{k + 1 / 2} - U_A z_k = r,
\]
\[
(D_A - U_A)z_k - L_A z_{k + 1 / 2} = r.
\]

进行迭代。由于 \(A\) 对称正定，因此对称 GS 迭代法是收敛的。

### 4.3 数值结果

#### 4.3.1 误差

| N    | 误差       |
| ---- | ---------- |
| 64   | 0.0015     |
| 128  | 3.7363e-04 |
| 256  | 9.3399e-05 |
| 512  | 2.3349e-05 |
| 1024 | 5.8298e-06 |
| 2048 | 1.4521e-06 |

#### 4.3.2 不同参数对运行时间和 V-cycle 次数的影响

预优共轭梯度法停机标准为 \(\sqrt{r^T r} > \max (\epsilon \| b\| _2,\tau \left\| B^T \hat{U}_k\right\|_2)\)。
V-cycle 多重网格算法停机标准为 \(\| r_k\| _2 / \| r_0\| _2\leq \text{error}\)。

**参数组 1:** \(\tau = 0.001, \epsilon = 1\mathrm{e-8}, \alpha = 1, \nu_{1} = 2, \nu_{2} = 2, \text{error} = 1\mathrm{e-3}\)，底层网格参数 \(N / L = 2\)，底层网格为 \(2\times 2\)

| N    | CPU 时间(秒) | Inexact Uzawa 迭代次数 | PCG 迭代次数（各外步） |
| ---- | ------------ | ---------------------- | ---------------------- |
| 64   | 0.0862       | 4                      | 3,2,3,3                |
| 128  | 0.2712       | 4                      | 3,2,3,3                |
| 256  | 1.065        | 4                      | 3,2,3,3                |
| 512  | 4.917        | 4                      | 2,3,3,3                |
| 1024 | 17.3015      | 2                      | 3,3                    |
| 2048 | 201.7559     | 2                      | 3,3                    |

**参数组 2:** \(\tau = 0.001, \epsilon = 1\mathrm{e-8}, \alpha = 1, \nu_{1} = 4, \nu_{2} = 4, \text{error} = 1\mathrm{e-3}\)，底层网格参数 \(N / L = 4\)，底层网格为 \(4\times 4\)

| N    | CPU 时间(秒) | Inexact Uzawa 迭代次数 | PCG 迭代次数（各外步） |
| ---- | ------------ | ---------------------- | ---------------------- |
| 64   | 0.0374       | 2                      | 2,2                    |
| 128  | 0.1360       | 2                      | 2,2                    |
| 256  | 0.5635       | 2                      | 2,2                    |
| 512  | 2.4935       | 2                      | 2,2                    |
| 1024 | 14.5262      | 2                      | 2,1                    |
| 2048 | 162.8681     | 2                      | 2,2                    |

**参数组 3:** \(\tau = 0.001, \epsilon = 1\mathrm{e-8}, \alpha = 1.05, \nu_{1} = 2, \nu_{2} = 2, \text{error} = 1\mathrm{e-3}\)，底层网格参数 \(N / L = 2\)，底层网格为 \(2\times 2\)

| N    | CPU 时间(秒) | Inexact Uzawa 迭代次数 | PCG 迭代次数（各外步） |
| ---- | ------------ | ---------------------- | ---------------------- |
| 64   | 0.1014       | 5                      | 3,2,3,3,3              |
| 128  | 0.3621       | 5                      | 3,2,3,3,3              |
| 256  | 1.7108       | 6                      | 3,2,3,3,3,3            |
| 512  | 26.1803      | 5                      | 2,3,3,3,3              |
| 1024 | 43.1189      | 5                      | 3,3,3,3,3              |
| 2048 | 302.3763     | 5                      | 3,3,3,3,3              |

**参数组 4:** \(\tau = 0.001, \epsilon = 1\mathrm{e-8}, \alpha = 1.05, \nu_{1} = 4, \nu_{2} = 4, \text{error} = 1\mathrm{e-3}\)，底层网格参数 \(N / L = 4\)，底层网格为 \(4\times 4\)

| N    | CPU 时间(秒) | Inexact Uzawa 迭代次数 | PCG 迭代次数（各外步） |
| ---- | ------------ | ---------------------- | ---------------------- |
| 64   | 0.1169       | 6                      | 2,2,2,2,2,2            |
| 128  | 0.3876       | 6                      | 2,2,2,2,2,2            |
| 256  | 1.6013       | 6                      | 2,2,2,1,2,2            |
| 512  | 7.4373       | 6                      | 2,2,2,2,2,2            |
| 1024 | 46.7608      | 6                      | 2,2,1,2,2,2            |
| 2048 | 323.2497     | 6                      | 2,2,2,2,2,2            |

**参数组 5:** \(\tau = 0.001, \epsilon = 1\mathrm{e-8}, \alpha = 0.95, \nu_{1} = 2, \nu_{2} = 2, \text{error} = 1\mathrm{e-3}\)，底层网格参数 \(N / L = 2\)，底层网格为 \(2\times 2\)

| N    | CPU 时间(秒) | Inexact Uzawa 迭代次数 | PCG 迭代次数（各外步） |
| ---- | ------------ | ---------------------- | ---------------------- |
| 64   | 0.1006       | 6                      | 3,2,3,3,3,3            |
| 128  | 0.3814       | 6                      | 3,2,3,3,3,3            |
| 256  | 1.6233       | 6                      | 3,2,3,1,3,3            |
| 512  | 6.1435       | 5                      | 3,2,3,3,3              |
| 1024 | 41.6549      | 5                      | 3,3,3,3,3              |
| 2048 | 290.2349     | 5                      | 3,3,3,3,3              |

**参数组 6:** \(\tau = 0.001, \epsilon = 1\mathrm{e-8}, \alpha = 0.95, \nu_{1} = 4, \nu_{2} = 4, \text{error} = 1\mathrm{e-3}\)，底层网格参数 \(N / L = 4\)，底层网格为 \(4\times 4\)

| N    | CPU 时间(秒) | Inexact Uzawa 迭代次数 | PCG 迭代次数（各外步） |
| ---- | ------------ | ---------------------- | ---------------------- |
| 64   | 0.0940       | 6                      | 2,2,2,2,2,2            |
| 128  | 0.3923       | 6                      | 2,2,2,2,2,2            |
| 256  | 1.5030       | 6                      | 2,2,2,1,2,2            |
| 512  | 7.4557       | 6                      | 2,2,2,2,2,2            |
| 1024 | 42.1823      | 6                      | 2,2,1,2,2,2            |
| 2048 | 279.9145     | 6                      | 2,2,2,2,2,2            |

**参数组 7:** \(\tau = 0.0001, \epsilon = 1\mathrm{e-8}, \alpha = 1, \nu_{1} = 4, \nu_{2} = 4, \text{error} = 1\mathrm{e-3}\)，底层网格参数 \(N / L = 4\)，底层网格为 \(4\times 4\)

| N    | CPU 时间(秒) | Inexact Uzawa 迭代次数 | PCG 迭代次数（各外步） |
| ---- | ------------ | ---------------------- | ---------------------- |
| 64   | 0.0270       | 2                      | 2,2                    |
| 128  | 0.1260       | 2                      | 2,2                    |
| 256  | 0.4176       | 2                      | 2,2                    |
| 512  | 2.5128       | 2                      | 2,2                    |
| 1024 | 16.3664      | 2                      | 2,1                    |
| 2048 | 182.8341     | 2                      | 2,2                    |

**参数组 8:** \(\tau = 1\mathrm{e-5}, \epsilon = 1\mathrm{e-8}, \alpha = 1, \nu_{1} = 4, \nu_{2} = 4, \text{error} = 1\mathrm{e-3}\)，底层网格参数 \(N / L = 4\)，底层网格为 \(4\times 4\)

N 64 128 256 512 1024 2048
CPU 时间（秒） 0.0322 0.1187 0.5429 2.4722 15.7753 156.2418
Inexact Uzawa 迭代次数 2 2 2 2 2 2
PCG 迭代次数 2,2 2,2 2,2 2,2 2,2 2,2